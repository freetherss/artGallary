# JIW Gallery 프로젝트 워크플로우

이 문서는 JIW Gallery 개인 갤러리 프로젝트의 개발 단계를 정의하고, 각 단계별 목표와 구현 사항을 추적하기 위해 작성되었습니다. 모든 개발 과정은 `docs/PRD.txt`와 `docs/SRS.txt`에 명시된 요구사항을 기반으로 합니다.

---

## 목차
1.  **프로젝트 개요**
2.  **개발 환경 점검**
3.  **1단계: 백엔드 기초 및 데이터 모델링**
4.  **2단계: 핵심 API 개발 (게시물 CRUD)**
5.  **3단계: 프론트엔드 구조 설정**
6.  **4단계: 프론트엔드 뷰 개발 (갤러리 및 상세 페이지)**
7.  **5단계: 기능 연결 및 1차 통합 테스트**
8.  **6단계: 사용자 계정 및 권한 시스템 도입**
9.  **7단계: 전체 기능 통합 및 최종 테스트**
10. **향후 계획**

---

### 1. 프로젝트 개요
- **목표:** 아티스트가 자신의 작품을 손쉽게 온라인에 게시하고 관리할 수 있는 개인화된 웹 갤러리 공간을 제공합니다.
- **핵심:** 직관적인 업로드 및 관리, 작품에 집중할 수 있는 깔끔한 UI, 해시태그 기반의 간단한 필터링, 역할 기반 권한 관리 기능을 구현합니다.
- **참고 문서:** `docs/PRD.txt`, `docs/SRS.txt`

### 2. 개발 환경 점검
- **요구사항:** Java (JDK), Gradle, MySQL, Node.js, Git.
- **구현 상황:** 모든 필수 소프트웨어의 설치가 완료되었습니다.
- **남은 작업:**
    - MySQL에 `jiw-gallery` 데이터베이스 생성.
    - 프로젝트에서 사용할 사용자 계정 및 권한 설정.

### 3. 1단계: 백엔드 기초 및 데이터 모델링
- **요구사항:** 게시물(이미지, 설명글, 해시태그) 정보를 데이터베이스에 저장할 수 있어야 합니다.
- **구현 방안:**
    - **JPA Entity 정의:** `Post` Entity 외에 사용자 정보(`User`)와 역할(`Role`)을 관리할 Entity를 추가로 정의합니다. `Post` Entity는 작성자를 참조하는 관계를 맺습니다 (`ManyToOne`).
    - **데이터베이스 연결:** `src/main/resources/application.properties` 파일에 MySQL 접속 정보를 설정합니다 (URL, username, password).
    - **초기 스키마:** Spring Boot 실행 시 JPA가 테이블을 자동으로 생성하도록 설정합니다.

### 4. 2단계: 핵심 API 개발 (게시물 CRUD)
- **요구사항:** (SRS: FR-1, FR-2, FR-5, FR-6) 이미지 업로드, 게시물 생성/수정/삭제 기능을 제공하는 API가 필요합니다.
- **구현 방안:**
    - **Repository 및 Service 생성:** `Post` 관련 `Repository`와 `Service`를 생성합니다.
    - **Controller 생성:** `PostController` 클래스를 생성하여 RESTful API 엔드포인트를 제공합니다. 초기 단계에서는 권한 검증 로직은 포함하지 않습니다.

### 5. 3단계: 프론트엔드 구조 설정
- **요구사항:** (SRS: FR-8) `TEXT/index.html`이 초기 페이지로 설정되어야 합니다.
- **구현 방안:**
    - `TEXT` 디렉토리 내에 `index.html`, `css`, `js` 폴더를 구성합니다. 로그인 페이지(`login.html`)도 추가로 생성합니다.

### 6. 4단계: 프론트엔드 뷰 개발
- **요구사항:** (SRS: FR-3, FR-4, FR-7) 갤러리 그리드, 상세 뷰, 해시태그 필터링 UI가 필요합니다.
- **구현 방안:**
    - API를 호출하여 갤러리 뷰, 상세 뷰를 동적으로 렌더링하는 로직을 `js/app.js`에 구현합니다.

### 7. 5단계: 기능 연결 및 1차 통합 테스트
- **요구사항:** 권한 부여 전 핵심 기능들이 유기적으로 동작해야 합니다.
- **구현 방안:**
    - 게시물 작성/수정/삭제 기능과 API를 연동하고, 기본적인 CRUD 흐름을 테스트합니다.

### 8. 6단계: 사용자 계정 및 권한 시스템 도입
- **요구사항:** (SRS: FR-9, FR-10, FR-11) 사용자 인증 및 `admin`/`guest` 역할 기반 권한 제어 기능이 필요합니다.
- **구현 방안:**
    - **Spring Security 적용:** 의존성을 추가하고, `SecurityConfig`를 설정하여 인증/인가를 처리합니다.
    - **인증 API 개발:** `/login` 엔드포인트를 통해 사용자 로그인을 처리하는 로직을 `UserController`에 구현합니다.
    - **게시물 API 권한 제어:** `PostController`의 각 엔드포인트에 `@PreAuthorize` 등의 어노테이션을 사용하여 `admin`과 `guest`의 권한에 따라 API 접근을 제어합니다.
        - `DELETE /api/posts/{id}`: `admin` 역할 또는 게시물 소유자(`guest`)만 접근 가능하도록 설정합니다.
    - **프론트엔드 로그인 연동:** `login.html`에서 로그인 API를 호출하고, 성공 시 받은 토큰(JWT 등)을 저장하여 이후 API 요청 헤더에 포함시킵니다.

### 9. 7단계: 전체 기능 통합 및 최종 테스트
- **요구사항:** 모든 기능이 권한 시스템과 함께 완전하게 동작해야 합니다.
- **구현 방안:**
    - `admin`과 `guest` 사용자로 각각 로그인하여 시나리오별 테스트를 수행합니다.
        - `guest`가 다른 사용자의 게시물을 수정/삭제하려고 할 때 거부되는지 확인합니다.
        - `admin`이 모든 게시물을 관리할 수 있는지 확인합니다.
    - 주요 브라우저에서 기능 및 레이아웃 호환성을 최종 테스트합니다.

### 10. 향후 계획
- PRD의 '초기 버전 제외 범위'에 명시된 기능들을 점진적으로 추가하는 것을 고려합니다.
    - 댓글 및 '좋아요' 기능 추가
    - 고급 검색 기능 구현
    - 전자상거래(E-commerce) 기능 추가

---

### 11. 버그 수정: 게시물 수정 시 이미지/이름 문제 해결

**문제점:**
게시물을 수정할 때, 포스트 이름이 변경되지 않고 기존 이름이 그대로 남아있거나, 이미지가 사라지는 문제가 발생했습니다. 이는 프론트엔드에서 기존 이미지 경로를 제대로 전달하지 못하고, 수정된 이름과 내용이 UI에 반영되지 않거나 백엔드에 올바르게 전달되지 않았기 때문입니다.

**해결 방안:**

1.  **`index.html` 수정:**
    *   게시물 수정 폼 (`postForm`) 내에 `currentImagePathInput`이라는 숨겨진 입력 필드 (`<input type="hidden" id="currentImagePathInput" name="currentImagePath">`)를 추가하여, 수정 중인 게시물의 현재 이미지 경로를 저장하도록 했습니다.

2.  **`app.js` 수정 (`openPostFormModal` 함수):**
    *   게시물 수정 모달을 열 때, 숨겨진 `currentImagePathInput` 필드에 현재 게시물의 `imagePath` 값을 할당하도록 했습니다.
    *   모달 내에서 게시물 `title`과 `description`이 올바르게 채워지도록 수정했습니다 (특히 `post.content`를 `postDescription`에 할당).
    *   현재 이미지를 텍스트로만 표시하던 것을 실제 `<img>` 태그로 변경하여 시각적으로 확인할 수 있게 했으며, 이미지를 삭제할 수 있는 체크박스 (`removeImageCheckbox`)를 추가했습니다.

3.  **`app.js` 수정 (`postForm` submit 이벤트 리스너):**
    *   폼 제출 시, `removeImageCheckbox`의 상태를 확인하도록 로직을 추가했습니다.
    *   만약 `removeImageCheckbox`가 체크되어 있으면, `postData`의 `imagePath`를 `null`로 설정하여 백엔드에 이미지 삭제를 명시적으로 요청하도록 했습니다.
    *   새로운 이미지가 업로드되지 않고 `removeImageCheckbox`가 체크되지 않은 경우, `currentImagePathInput`에 저장된 값을 `postData`의 `imagePath`로 포함시켜 백엔드에 기존 이미지를 유지하도록 요청했습니다.

**결과:**
이러한 프론트엔드 변경을 통해 게시물 수정 시 이름과 설명이 올바르게 업데이트되고, 기존 이미지를 유지하거나 명시적으로 삭제할 수 있게 되어, 사용자가 기대하는 동작대로 기능이 수행됩니다. 백엔드 (`PostService`)는 이러한 프론트엔드 요청(새 이미지, 이미지 삭제, 기존 이미지 유지)을 처리할 수 있도록 이미 구현되어 있었으므로 백엔드 수정은 필요하지 않았습니다.

---

### 12. 보안 점검 및 강화
- **수행 내용:** 2025년 12월 19일, 전체 코드 베이스에 대한 보안 점검을 수행했습니다.
- **주요 발견 사항:**
    1.  **하드코딩된 JWT 비밀 키:** `application.properties` 파일에 JWT 서명 키가 평문으로 저장되어 있어, 소스 코드 접근 시 키가 노출될 위험이 있습니다.
    2.  **안전하지 않은 파일 업로드:** 파일 업로드 시 파일 확장자나 콘텐츠 타입을 검증하지 않아, 이미지 파일이 아닌 악성 스크립트(웹 쉘 등)가 서버에 업로드될 가능성이 있습니다.
- **조치 사항:**
    - 상기 취약점을 해결하기 위한 새로운 요구사항이 `docs/SRS.txt`에 `4. 보안 요구사항` 섹션으로 추가되었습니다. (참고: SR-1, SR-2)
    - 향후 개발에서는 해당 요구사항을 충족하도록 코드를 수정해야 합니다.